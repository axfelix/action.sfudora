<?xml version="1.0" encoding="UTF-8"?>
<ajxp_plugin name="islandora" label="CONF_MESSAGE[Islandora Integration]" description="CONF_MESSAGE[Ingest files into Islandora]"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:../core.ajaxplorer/ajxp_registry.xsd">
    <client_settings>
        <resources>
            <i18n namespace="action.islandora" path="plugins/action.islandora/i18n"/>
            <js file="plugins/action.islandora/class.Islandora.js" className="Islandora" autoload="true"/>
        </resources>
    </client_settings>
    <server_settings>
        <global_param name="ISLANDORA_URL" group="CONF_MESSAGE[Islandora]" description="CONF_MESSAGE[Islandora URL]" label="CONF_MESSAGE[Islandora URL]" type="string" expose="true"/>
    </server_settings>
    <registry_contributions>
        <actions>
            <action name="islandora_ingest">
                <gui text="action.islandora.title" title="action.islandora.title" src="share.png" iconClass="icon-share" hasAccessKey="false">
                <context selection="true" dir="true" recycle="false"
                         actionBar="true" contextMenu="true" infoPanel="false"
                         actionBarGroup="get">
                </context>
                <selectionContext dir="true" file="true" recycle="false" unique="true"></selectionContext>
                </gui>
                <rightsContext noUser="true" userLogged="only" read="true" write="true" adminOnly=""></rightsContext>
                <processing>
                    <clientCallback prepareModal="true" dialogOpenForm="islandora_form" dialogOkButtonOnly="false" dialogSkipButtons="false">
                       <dialogOnOpen><![CDATA[
                           this.currentFormManager = new FormManager();
                           var xmlDefinition = ajaxplorer.getXmlRegistry();
                           var node = XPathSelectSingleNode(xmlDefinition, 'actions/action[@name="islandora_ingest"]/processing/standardFormDefinition');

                           this.currentFormManager.params = this.currentFormManager.parseParameters(node, "param");
                           this.currentFormManager.createParametersInputs(
                                $('islandora_form'),
                                    this.currentFormManager.params,
                                    true
                               );
                           
                       ]]></dialogOnOpen>
                        <dialogOnComplete><![CDATA[
                             var values = new Hash({});
                            this.currentFormManager.serializeParametersInputs(
                                $('islandora_form'),
                                values,
                                '');
                            

                    
                    ]]></dialogOnComplete>
                    </clientCallback>
                    <clientForm id="islandora_form"><![CDATA[
                         <div id="islandora_form" box_width="330"></div>
                    ]]></clientForm>
                    <standardFormDefinition>
                        <param name="field1" group="Execution Context" label="action.islandora.1" description="action.islandora.1d" type="string" mandatory="true"/>
                        <param name="field2" group="Execution Context" label="action.islandora.2" description="action.islandora.2d" type="string" mandatory="true"/>
                    </standardFormDefinition>
                    <serverCallback methodName="switchAction"></serverCallback>
                </processing>
            </action>
        </actions>
    </registry_contributions>
    <class_definition filename="plugins/action.islandora/class.Islandora.php" classname="Islandora"/>
</ajxp_plugin>